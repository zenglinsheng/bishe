<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>修改学生信息-师生人事管理系统-WeAdmin 1.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/weadmin.css">
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<style>
    input.text{background-color:#EEE9E9}
</style>

<body>
<div class="weadmin-body">
    <form class="layui-form">
        <div class="layui-input-inline">
            <input type="hidden" id="userId" name="userId" autocomplete="off" class="layui-input userId text" readonly="true">
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">学号</label>
            <div class="layui-input-inline">
                <input type="text" id="number" name="number" autocomplete="off" class="layui-input number text" readonly="true">
            </div>
            <label class="layui-form-label">姓名</label>
            <div class="layui-input-inline">
                <input type="text" id="username" name="username" autocomplete="" class="layui-input username text" readonly="true">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">现班级</label>
            <div class="layui-input-inline">
                <input type="text" id="className" name="className" autocomplete="" class="layui-input className text" readonly="true">
            </div>
            <label class="layui-form-label">转班班级</label>
            <div class="layui-input-inline" >
                <select id="selectId" name="classId" lay-filter="classId" class="classId"><option value="0">请选择班级</option></select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">电话</label>
            <div class="layui-input-inline">
                <input type="text" id="telephone" name="telephone" autocomplete="off" class="layui-input telephone" lay-verify="phone">
            </div>
            <label class="layui-form-label">邮箱</label>
            <div class="layui-input-inline">
                <input type="text" id="email" name="email" autocomplete="off" class="layui-input email" lay-verify="email">
            </div>
        </div>

        <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <input type="radio" name="gender" value="0" title="男" id="gender" lay-verify="otherReq" {$sex.level=="0"?"checked":""}>
                    <input type="radio" name="gender" value="1" title="女" id="gender1" lay-verify="otherReq" {$sex.level=="1"?"checked":""}>
                </div>
        </div>

        <div class="layui-form-item">
                <label class="layui-form-label">婚姻状况</label>
                <div class="layui-input-block">
                    <input type="radio" name="maritalStatus" value="0" title="未婚" id="maritalStatus" lay-verify="otherReq" {$sex.level=="0"?"checked":""}>
                    <input type="radio" name="maritalStatus" value="1" title="已婚" id="maritalStatus1" lay-verify="otherReq" {$sex.level=="1"?"checked":""}>
                    <input type="radio" name="maritalStatus" value="2" title="未知" id="maritalStatus2" lay-verify="otherReq" {$sex.level=="2"?"checked":""}>
                </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">政治面貌</label>
            <div class="layui-input-block">
                <input type="radio" name="politicalAppearance" value="0" title="群众" id="politicalAppearance" lay-verify="otherReq" {$sex.level=="0"?"checked":""}>
                <input type="radio" name="politicalAppearance" value="1" title="中共团员" id="politicalAppearance1" lay-verify="otherReq" {$sex.level=="1"?"checked":""}>
                <input type="radio" name="politicalAppearance" value="2" title="中共党员" id="politicalAppearance2" lay-verify="otherReq" {$sex.level=="2"?"checked":""}>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">籍贯</label>
            <div class="layui-input-inline">
                <input type="text" id="nativePlace" name="nativePlace" autocomplete="" class="layui-input nativePlace">
            </div>
            <label class="layui-form-label">出生年月</label>
            <div class="layui-input-inline">
                <input type="text" id="birthdayStr" name="birthdayStr" class="layui-input birthdayStr">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">民族</label>
            <div class="layui-input-inline">
                <input type="text" id="nation" name="nation" autocomplete="" class="layui-input nation">
            </div>
            <label class="layui-form-label">毕业学校</label>
            <div class="layui-input-inline">
                <input type="text" id="graduationSchool" name="graduationSchool" autocomplete="" class="layui-input graduationSchool">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">身份证号</label>
            <div class="layui-input-inline">
                <input type="text" id="idNumber" name="idNumber" autocomplete="" class="layui-input idNumber" lay-verify="identity">
            </div>
            <label class="layui-form-label">入学时间</label>
            <div class="layui-input-inline">
                <input type="text" id="entranceTimeStr" name="entranceTimeStr" class="layui-input entranceTimeStr">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">住宅电话</label>
            <div class="layui-input-inline">
                <input type="text" id="residentialTel" name="residentialTel" autocomplete="" class="layui-input residentialTel">
            </div>
            <label class="layui-form-label">邮编</label>
            <div class="layui-input-inline">
                <input type="text" id="zipCode" name="zipCode" autocomplete="" class="layui-input zipCode" lay-verify="number">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">户口所在地</label>
            <div class="layui-input-block">
                <input type="text" id="registeredResidence" name="registeredResidence" autocomplete="off" class="layui-input registeredResidence">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">家庭住址</label>
            <div class="layui-input-block">
                <input type="text" id="familyAddress" name="familyAddress" autocomplete="off" class="layui-input familyAddress">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label"></label>
            <button class="layui-btn" lay-filter="update" lay-submit="add">提交</button>
        </div>

    </form>
</div>
<script src="../../lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    layui.extend({
        admin: '{/}../js/admin'
    });
    layui.use(['form', 'jquery', 'admin','layer','laydate'], function() {
        var form = layui.form,
            $ = layui.jquery,
            admin = layui.admin,
            layer = layui.layer,
            laydate = layui.laydate;

        laydate.render({
            elem: '#birthdayStr'
        });
        laydate.render({
            elem: '#entranceTimeStr'
        });

        //自定义验证规则
        layui.form.verify({
           otherReq: function(value,item){
                var verifyName=$(item).attr('name')
                    , verifyType=$(item).attr('type')
                    ,formElem=$(item).parents('.layui-form')//获取当前所在的form元素，如果存在的话
                    ,verifyElem=formElem.find('input[name='+verifyName+']')//获取需要校验的元素
                    ,isTrue= verifyElem.is(':checked')//是否命中校验
                    ,focusElem = verifyElem.next().find('i.layui-icon');//焦点元素
                if(!isTrue || !value){
                    //定位焦点
                    focusElem.css(verifyType=='radio'?{"color":"#FF5722"}:{"border-color":"#FF5722"});
                    //对非输入框设置焦点
                    focusElem.first().attr("tabIndex","1").css("outline","0").blur(function() {
                        focusElem.css(verifyType=='radio'?{"color":""}:{"border-color":""});
                    }).focus();
                    //return '性别不能为空';
                }
            }
        });

        //监听提交
        form.on('submit(update)', function(data){
            layer.confirm("是否修改该学生个人信息？", {btn: ['确定','取消']},function () {
                console.log("data.field=",data.field)
                $.ajax({
                    url:'http://localhost:8088/student/updateOneByAdmin',
                    dataType:'json',
                    data:data.field,
                    //type:'post',
                    success:function(res){
                        layer.msg('修改成功！');
                        form.render()
                    },
                    fail:function () {
                        layer.msg('修改失败！');
                    }
                });
            });
            return false;
        });

        //获取班级列表
        $.ajax({
            url:'http://localhost:8088/class/selectAllClasses',
            dataType:'json',
            success:function(res){

                $.each(res.data,function(index,item){
                    //option 第一个参数是页面显示的值，第二个参数是传递到后台的值
                    $('#selectId').append(new Option(item.classname,item.classId));//往下拉菜单里添加元素
                    //设置value（这个值就可以是在更新的时候后台传递到前台的值）为2的值为默认选中
                    $('#selectId').val(0);
                })

                form.render(); //更新全部表单内容
            }
        });

    });
</script>
</body>

</html>